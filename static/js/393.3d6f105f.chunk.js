"use strict";(self.webpackChunkhuman_atlas=self.webpackChunkhuman_atlas||[]).push([[393],{1605:(e,t,n)=>{n.d(t,{A:()=>i});n(5043);const i=n.p+"static/media/arrow.78eec37b3f4960eb72cb6a0e049c7fb5.svg"},7509:(e,t,n)=>{n.d(t,{A:()=>o});n(5043);var i=n(4545),r=n(579);function o(e){let{isOpen:t,onClose:n,onConfirm:o,title:s,message:a,actionName:c,actionColor:l}=e;return t?(0,r.jsxs)(i.A,{title:s,onClose:n,children:[(0,r.jsx)("p",{children:a}),(0,r.jsxs)("div",{className:"modal-actions",children:[(0,r.jsx)("button",{className:"modal-button cancel-button",onClick:n,children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),(0,r.jsx)("button",{className:`modal-button confirm-button ${l}`,onClick:o,children:c})]})]}):null}},4545:(e,t,n)=>{n.d(t,{A:()=>r});n(5043),n(6936);var i=n(579);function r(e){let{title:t,children:n,onClose:r,className:o}=e;return(0,i.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target.classList.contains("modal-overlay")&&r()},children:(0,i.jsxs)("div",{className:`modal-container ${o||""}`,children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h2",{children:t}),(0,i.jsx)("button",{className:"close-button",onClick:r,children:"\u2715"})]}),(0,i.jsx)("div",{className:"modal-content",children:n})]})})}},3541:(e,t,n)=>{n.d(t,{$:()=>r,F:()=>o});var i=n(6654);async function r(e){try{const t=await(0,i.A)(`/v1/organs/get/${e}`);if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error fetching organ by organ ID:",t.message)}}async function o(e){try{const t=await(0,i.A)(`/v1/organs/get-by-categoryid/${e}`);if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error fetching organ by organs ID:",t.message)}}},1393:(e,t,n)=>{n.r(t),n.d(t,{default:()=>te});var i=n(3216),r=n(5043),o=n(830);const s=(0,o.Z0)({name:"atlas",initialState:{activeTool:"\u041a\u0443\u0440\u0441\u043e\u0440",currMenu:"close",searchString:"",targetPoint:{description:"",id:0,name:"",organid:0,x:0,y:0}},reducers:{setActiveTool(e,t){e.activeTool=t.payload},setCurrMenu(e,t){e.currMenu=t.payload},setSearchString(e,t){e.searchString=t.payload},setTargetPoint(e,t){e.targetPoint=t.payload}}}),{setActiveTool:a,setCurrMenu:c,setSearchString:l,setTargetPoint:d}=s.actions,h=s.reducer,u=(0,o.U1)({reducer:{atlas:h}});var f=n(4391),m=n(9820),v=n.n(m);!function(e){if(!e.version||e.version.major<2)throw new Error("This version of OpenSeadragonScalebar requires OpenSeadragon version 2.0.0+");function t(e,t,n,r,s){s=void 0===s?" ":s;var a=i(e,t),c=o(a/e*t,3);return{size:a*t,text:c+s+n+(r&&c>1?"s":"")}}function n(e,t,n){var r=i(e,t),s=r*t,a=function(e,t){if(e<1e-6)return 1e9*e+" n"+t;if(e<.001)return 1e6*e+" \u03bc"+t;if(e<1)return 1e3*e+" m"+t;if(e>=1e3)return e/1e3+" k"+t;return e+" "+t}(o(r/e*t,3),n);return{size:s,text:a}}function i(e,t){var n=r(e),i=r(t),o=r(n/i);return o>=5&&(o/=5),o>=4&&(o/=4),o>=2&&(o/=2),o}function r(e){return e*Math.pow(10,Math.ceil(-s(e)))}function o(e,t){var n=t- -Math.ceil(-s(e)),i=e*Math.pow(10,n);return n<0?Math.round(i)*Math.pow(10,-n):Math.round(i)/Math.pow(10,n)}function s(e){return Math.log(e)/Math.log(10)}function a(e){return"undefined"!==typeof e}e.Viewer.prototype.scalebar=function(t){this.scalebarInstance?this.scalebarInstance.refresh(t):((t=t||{}).viewer=this,this.scalebarInstance=new e.Scalebar(t))},e.ScalebarType={NONE:0,MICROSCOPY:1,MAP:2},e.ScalebarLocation={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},e.Scalebar=function(t){if(!(t=t||{}).viewer)throw new Error("A viewer must be specified.");this.viewer=t.viewer,this.divElt=document.createElement("div"),this.viewer.container.appendChild(this.divElt),this.divElt.style.position="relative",this.divElt.style.margin="0",this.divElt.style.pointerEvents="none",this.setMinWidth(t.minWidth||"150px"),this.setDrawScalebarFunction(t.type||e.ScalebarType.MICROSCOPY),this.color=t.color||"black",this.fontColor=t.fontColor||"black",this.backgroundColor=t.backgroundColor||"none",this.fontSize=t.fontSize||"",this.fontFamily=t.fontFamily||"",this.barThickness=t.barThickness||2,this.pixelsPerMeter=t.pixelsPerMeter||null,this.referenceItemIdx=t.referenceItemIdx||0,this.location=t.location||e.ScalebarLocation.BOTTOM_LEFT,this.xOffset=t.xOffset||5,this.yOffset=t.yOffset||5,this.stayInsideImage=!a(t.stayInsideImage)||t.stayInsideImage,this.sizeAndTextRenderer=t.sizeAndTextRenderer||e.ScalebarSizeAndTextRenderer.METRIC_LENGTH;var n=this;this.viewer.addHandler("open",(function(){n.refresh()})),this.viewer.addHandler("animation",(function(){n.refresh()})),this.viewer.addHandler("resize",(function(){n.refresh()}))},e.Scalebar.prototype={updateOptions:function(e){e&&(a(e.type)&&this.setDrawScalebarFunction(e.type),a(e.minWidth)&&this.setMinWidth(e.minWidth),a(e.color)&&(this.color=e.color),a(e.fontColor)&&(this.fontColor=e.fontColor),a(e.backgroundColor)&&(this.backgroundColor=e.backgroundColor),a(e.fontSize)&&(this.fontSize=e.fontSize),a(e.fontFamily)&&(this.fontFamily=e.fontFamily),a(e.barThickness)&&(this.barThickness=e.barThickness),a(e.pixelsPerMeter)&&(this.pixelsPerMeter=e.pixelsPerMeter),a(e.referenceItemIdx)&&(this.referenceItemIdx=e.referenceItemIdx),a(e.location)&&(this.location=e.location),a(e.xOffset)&&(this.xOffset=e.xOffset),a(e.yOffset)&&(this.yOffset=e.yOffset),a(e.stayInsideImage)&&(this.stayInsideImage=e.stayInsideImage),a(e.sizeAndTextRenderer)&&(this.sizeAndTextRenderer=e.sizeAndTextRenderer))},setDrawScalebarFunction:function(t){t?t===e.ScalebarType.MAP?this.drawScalebar=this.drawMapScalebar:this.drawScalebar=this.drawMicroscopyScalebar:this.drawScalebar=null},setMinWidth:function(e){this.divElt.style.width=e,this.divElt.style.display="",this.minWidth=this.divElt.offsetWidth},refresh:function(e){if(this.updateOptions(e),this.viewer.isOpen()&&this.drawScalebar&&this.pixelsPerMeter&&this.location){this.divElt.style.display="";var t=this.viewer.viewport,n=function(e,t){var n=e._scaleSpring.current.value*e.viewport._containerInnerSize.x/e.source.dimensions.x;return n*t}(this.viewer.world.getItemAt(this.referenceItemIdx),t.getZoom(!0)),i=n*this.pixelsPerMeter,r=this.sizeAndTextRenderer(i,this.minWidth);this.drawScalebar(r.size,r.text);var o=this.getScalebarLocation();this.divElt.style.left=o.x+"px",this.divElt.style.top=o.y+"px"}else this.divElt.style.display="none"},drawMicroscopyScalebar:function(e,t){this.divElt.style.fontSize=this.fontSize,this.divElt.style.fontFamily=this.fontFamily,this.divElt.style.textAlign="center",this.divElt.style.color=this.fontColor,this.divElt.style.border="none",this.divElt.style.borderBottom=this.barThickness+"px solid "+this.color,this.divElt.style.backgroundColor=this.backgroundColor,this.divElt.innerHTML=t,this.divElt.style.width=e+"px"},drawMapScalebar:function(e,t){this.divElt.style.fontSize=this.fontSize,this.divElt.style.fontFamily=this.fontFamily,this.divElt.style.textAlign="center",this.divElt.style.color=this.fontColor,this.divElt.style.border=this.barThickness+"px solid "+this.color,this.divElt.style.borderTop="none",this.divElt.style.backgroundColor=this.backgroundColor,this.divElt.innerHTML=t,this.divElt.style.width=e+"px"},getScalebarLocation:function(){if(this.location===e.ScalebarLocation.TOP_LEFT){var t=0,n=0;if(this.stayInsideImage){var i=this.viewer.viewport.pixelFromPoint(new e.Point(0,0),!0);this.viewer.wrapHorizontal||(t=Math.max(i.x,0)),this.viewer.wrapVertical||(n=Math.max(i.y,0))}return new e.Point(t+this.xOffset,n+this.yOffset)}if(this.location===e.ScalebarLocation.TOP_RIGHT){var r=this.divElt.offsetWidth;t=(s=this.viewer.container).offsetWidth-r,n=0;if(this.stayInsideImage){i=this.viewer.viewport.pixelFromPoint(new e.Point(1,0),!0);this.viewer.wrapHorizontal||(t=Math.min(t,i.x-r)),this.viewer.wrapVertical||(n=Math.max(n,i.y))}return new e.Point(t-this.xOffset,n+this.yOffset)}if(this.location===e.ScalebarLocation.BOTTOM_RIGHT){r=this.divElt.offsetWidth;var o=this.divElt.offsetHeight;t=(s=this.viewer.container).offsetWidth-r,n=s.offsetHeight-o;if(this.stayInsideImage){i=this.viewer.viewport.pixelFromPoint(new e.Point(1,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(t=Math.min(t,i.x-r)),this.viewer.wrapVertical||(n=Math.min(n,i.y-o))}return new e.Point(t-this.xOffset,n-this.yOffset)}if(this.location===e.ScalebarLocation.BOTTOM_LEFT){var s;o=this.divElt.offsetHeight,t=0,n=(s=this.viewer.container).offsetHeight-o;if(this.stayInsideImage){i=this.viewer.viewport.pixelFromPoint(new e.Point(0,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(t=Math.max(t,i.x)),this.viewer.wrapVertical||(n=Math.min(n,i.y-o))}return new e.Point(t+this.xOffset,n-this.yOffset)}},getAsCanvas:function(){var e=document.createElement("canvas");e.width=this.divElt.offsetWidth,e.height=this.divElt.offsetHeight;var t=e.getContext("2d");t.fillStyle=this.backgroundColor,t.fillRect(0,0,e.width,e.height),t.fillStyle=this.color,t.fillRect(0,e.height-this.barThickness,e.width,e.height),this.drawScalebar===this.drawMapScalebar&&(t.fillRect(0,0,this.barThickness,e.height),t.fillRect(e.width-this.barThickness,0,this.barThickness,e.height)),t.font=window.getComputedStyle(this.divElt).font,t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.fontColor;var n=e.width/2,i=e.height/2;return t.fillText(this.divElt.textContent,n,i),e},getImageWithScalebarAsCanvas:function(){var e=this.viewer.drawer.canvas,t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0);var i=this.getAsCanvas(),r=this.getScalebarLocation();return n.drawImage(i,r.x,r.y),t}},e.ScalebarSizeAndTextRenderer={METRIC_LENGTH:function(e,t){return n(e,t,"m")},IMPERIAL_LENGTH:function(e,n){var i=2*n,r=.0254*e;if(i<12*r)return i<r?t(r/1e3,n,"th"):t(r,n,"in");var o=12*r;return i<2e3*o?t(o,n,"ft"):t(5280*o,n,"mi")},ASTRONOMY:function(e,n){var i=2*n;if(i<60*e)return t(e,n,'"',!1,"");var r=60*e;return i<60*r?t(r,n,"'",!1,""):t(60*r,n,"&#176",!1,"")},STANDARD_TIME:function(e,i){var r=2*i;if(r<60*e)return n(e,i,"s");var o=60*e;if(r<60*o)return t(o,i,"minute",!0);var s=60*o;if(r<24*s)return t(s,i,"hour",!0);var a=24*s;return r<365.25*a?t(a,i,"day",!0):t(365.25*a,i,"year",!0)},METRIC_GENERIC:n}}(v());var p=n(3003),g=n(579);function x(e){let{point:t,osdViewer:n}=e;const i=(0,p.d4)((e=>e.atlas.currMenu)),o=(0,p.d4)((e=>e.atlas.activeTool)),s=(0,p.d4)((e=>e.atlas.targetPoint)),l=(0,p.wA)();(0,r.useEffect)((()=>{console.log("INIT",t)}),[]);return(0,g.jsx)("div",{className:"point-container",onPointerDown:e=>{e.preventDefault(),"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===o&&(l(c("menu")),l(d({...t})),l(a("\u041a\u0443\u0440\u0441\u043e\u0440"))),"\u041a\u0443\u0440\u0441\u043e\u0440"===o&&(l(c("info")),l(d({...t}))),"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===o&&l(d({...t,status:"move"}))},children:(0,g.jsx)("div",{className:s.id!==t.id||"close"===i&&"move"!==s.status?"marker":"marker marker-select"})})}var y=n(6654);async function w(e){try{const t=await(0,y.A)("/v1/points/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error editing point:",t.message)}}var b=n(3541),E=n(6065);const S=(0,r.forwardRef)(((e,t)=>{let{slideData:n,onViewerReady:i}=e;const o=(0,p.d4)((e=>e.atlas.activeTool)),s=(0,p.d4)((e=>e.atlas.targetPoint)),l=(0,p.wA)(),{showNotification:h}=(0,E.h)(),m=(0,r.useRef)(null),S=(0,r.useRef)(null),j=(0,r.useRef)([]),T=(0,r.useRef)([]),N=e=>{const t=document.createElement("div");j.current.push({point:e,container:t}),console.log(m),m.current.addOverlay({element:t,location:new(v().Point)(e.x,e.y),placement:v().Placement.CENTER});(0,f.createRoot)(t).render((0,g.jsx)(p.Kq,{store:u,children:(0,g.jsx)(x,{point:e,osdViewer:m})}))},C=()=>{j.current.forEach((e=>{let{point:t,container:n}=e;t.id===s.id&&m.current.removeOverlay(n)})),console.log("REMOVE OVERLAY",s),j.current=j.current.filter((e=>{let{point:t}=e;return t.id!==s.id}))},k=e=>{e?(j.current.forEach((e=>{let{container:t}=e;m.current.removeOverlay(t)})),j.current=[]):T.current.forEach((e=>N(e)))};(0,r.useImperativeHandle)(t,(()=>({togglePoints:k}))),(0,r.useEffect)((()=>(T.current=n.points,m.current=v()({id:S.current.id,prefixUrl:"https://openseadragon.github.io/openseadragon/images/",tileSources:n.dziPath,crossOriginPolicy:"Anonymous",zoomInButton:"zoom-in",zoomOutButton:"zoom-out"}),async function(){console.log("MPP");const e=await(0,b.$)(n.organ.id),t=1/(1e-6*Number(e.mpp_x));m.current.scalebar({type:v().ScalebarType.MICROSCOPY,pixelsPerMeter:t,color:"#4670B4",fontColor:"#4670B4",backgroundColor:"rgba(255, 255, 255, 0.5)",barThickness:1,location:v().ScalebarLocation.TOP_LEFT,xOffset:200,yOffset:35,minWidth:"200px",maxWidth:"100px",stayInsideImage:!1})}(),console.log("OSD"),console.log(m),m.current.addHandler("canvas-click",(e=>{e.preventDefaultAction=!0})),m.current.addHandler("open",(()=>{T.current.forEach((e=>N(e))),i&&i()})),()=>{m.current&&(m.current.destroy(),m.current=null),j.current.forEach((e=>{let{container:t}=e;return t.remove()})),j.current=[],console.log("END")})),[]),(0,r.useEffect)((()=>{"del"===s.status&&(T.current=T.current.filter((e=>e.id!==s.id)),console.log("ZDES"),C());const{status:e,...t}=s;T.current=T.current.map((e=>e.id===s.id?{...e,...t}:e)),console.log("TARGET",s)}),[s]),(0,r.useEffect)((()=>{async function e(e){if(e.preventDefaultAction=!0,console.log("CANVAS-CLICK",o),"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===o){const t=m.current.viewport.pointFromPixel(e.position),i=await async function(e,t,n,i,r){try{const o=await(0,y.A)("/v1/points/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({x:e,y:t,organid:n,name:r,description:i})});if(o.error)throw new Error(o.error||"Failed to add point");return o}catch(o){console.error("Error adding point:",o.message)}}(t.x,t.y,n.organ.id,"","");h("\u0422\u043e\u0447\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430","info"),console.log("POINT ID",i.point_id);const r={description:"",id:i.point_id,name:"",organid:n.organ.id,x:t.x,y:t.y};N(r),T.current.push(r),l(d(r)),l(c("menu")),l(a("\u041a\u0443\u0440\u0441\u043e\u0440"))}if("\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===o&&(console.log("PEREMESTIL",s),"move"===s.status)){console.log("MOVE");const t=m.current.viewport.pointFromPixel(e.position);O(s.id,t.x,t.y),l(d({...s,x:t.x,y:t.y})),console.log(s)}}if(m.current)return"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===o?l(c("close")):"move"===s.status&&(console.log("REMOVE STATUS",s),O(s.id,s.x,s.y),l(d({...s,status:""}))),m.current.addHandler("canvas-click",e),()=>{console.log("remove HANDLERS"),m.current&&m.current.removeHandler("canvas-click",e)}}),[o,s]);const O=async(e,t,n)=>{const i=await w({id:e,x:t,y:n});console.log(i),console.log("position",t,n)};return(0,r.useEffect)((()=>{C(),T.current.forEach((e=>{e.id===s.id&&(console.log("SHOW OVERLAY",e),N(e))})),n.points=T.current}),[T.current]),(0,g.jsx)("div",{className:"map-container",children:(0,g.jsx)("div",{id:"openseadragon1",ref:S,className:"openseadragon-viewer"})})}));var j=n(6849);function T(){return(0,g.jsx)("div",{className:"loading-spinner",children:(0,g.jsx)(j.A,{color:"#3754ED",cssOverride:{},size:25})})}var N=n(3418);function C(e){let{togglePointsVisibility:t}=e;const[n,i]=(0,r.useState)(!1);return(0,g.jsxs)("label",{className:"toggle-points-checkbox float-menu-button",children:[(0,g.jsx)("input",{type:"checkbox",checked:n,onChange:()=>{i(!n),t(!n)}}),(0,g.jsx)("span",{className:"custom-checkbox"}),(0,g.jsx)("span",{className:"checkbox-label",children:"\u0421\u043a\u0440\u044b\u0442\u044c \u0442\u043e\u0447\u043a\u0438"})]})}var k=n(1605);function O(){return(0,g.jsxs)("div",{className:"zoombar float-menu-button",children:[(0,g.jsx)("button",{id:"zoom-in",className:"zoom-buttons",children:"+"}),(0,g.jsx)("button",{style:{fontWeight:900},id:"zoom-out",className:"zoom-buttons",children:"\u2013"})]})}const M=n.p+"static/media/cursor.ffff59d38ae3528cccaed0f3b9beec34.svg";const I=n.p+"static/media/add-point.95bbd991f98a2f18dc1a39b56b0038e8.svg";const A=n.p+"static/media/pencil.c498dd5aea07ae568b8c2fdc30e78e5b.svg";const P=n.p+"static/media/move-point.0a60893ab071f248d1c45ad1981cfdfd.svg";const R=n.p+"static/media/divider.879710fa0f3155e17fb193467dfbe131.svg";function z(e){let{icon:t,name:n,hotkey:i,isActive:o=!1,onClick:s}=e;const[a,c]=(0,r.useState)(!1),l=/Mac/i.test(navigator.platform)?"CMD":"CTRL";return(0,g.jsxs)("div",{className:"tool-button-container",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[(0,g.jsx)("button",{className:"tool-button "+(o?"active-tool":""),onPointerDown:s,title:`${n} (${l} + ${i.toUpperCase()})`,"aria-pressed":o,children:(0,g.jsx)("img",{src:t,alt:n})}),a&&(0,g.jsxs)("div",{className:"tooltip",children:[n," ",(0,g.jsxs)("span",{className:"hotkey-name",children:[l," + ",i.toUpperCase()]})]})]})}function L(){const e=(0,p.d4)((e=>e.atlas.activeTool)),t=(0,p.wA)(),n=[{icon:M,name:"\u041a\u0443\u0440\u0441\u043e\u0440",hotkey:"b"},{icon:I,name:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443",hotkey:"p"},{icon:A,name:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u0447\u043a\u0443",hotkey:"e"},{icon:P,name:"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443",hotkey:"m"}],i=e=>{console.log(e),t(a(e))},o=e=>{if(!(e.ctrlKey||e.metaKey))return;const t=n.find((t=>t.hotkey===e.key.toLowerCase()));t&&(e.preventDefault(),i(t.name))};return(0,r.useEffect)((()=>(window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)})),[]),(0,g.jsx)("div",{className:"toolbar-wrapper",children:(0,g.jsxs)("div",{className:"toolbar-container",children:[(0,g.jsx)("div",{className:"buttons-container",children:n.map((t=>(0,g.jsx)(z,{icon:t.icon,name:t.name,hotkey:t.hotkey,isActive:e===t.name,onClick:()=>i(t.name)},t.name)))}),(0,g.jsx)("img",{src:R,alt:"divider",className:"divider"}),(0,g.jsx)("button",{className:"saveAndExit",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438 \u0432\u044b\u0439\u0442\u0438"})]})})}n.p;n.p;n.p;var D=n(9813),F=n(9285),H=n(9618),$=n(7977);const _=e=>{const t=$.A.sanitize(e,{ALLOWED_TAGS:["u","a","b","i"]});return console.log(e),console.log(t),t};function W(e){let{children:t}=e;const[n,i]=(0,r.useState)("");return(0,r.useEffect)((()=>{i(_(t))}),[t]),(0,g.jsx)("div",{className:"markdown",children:(0,g.jsx)(D.o,{remarkPlugins:[F.A],rehypePlugins:[H.A],children:n})})}var V=n(7509);function B(){const e=(0,p.d4)((e=>e.atlas.targetPoint)),t=(0,p.wA)(),{showNotification:n}=(0,E.h)(),[i,o]=(0,r.useState)(""),[s,a]=(0,r.useState)(""),[l,h]=(0,r.useState)(!1),[u,f]=(0,r.useState)(!1),[m,v]=(0,r.useState)(!0),[x,b]=(0,r.useState)("markdown"),S=(0,r.useRef)(null);(0,r.useEffect)((()=>{o(e.name),a(e.description)}),[e]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(V.A,{isOpen:u,onClose:()=>{f(!1)},onConfirm:async()=>{await async function(e){try{const t=await(0,y.A)("/v1/points/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error deleting point:",t.message)}}(e.id),t(d({id:e.id,status:"del"})),t(c("close")),n("\u0422\u043e\u0447\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u0430","info")},title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435",message:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443?",actionName:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",actionColor:"red"}),(0,g.jsxs)("div",{className:"point-menu-container",children:[(0,g.jsx)("input",{type:"text",className:"input-title",value:i,onChange:e=>o(e.target.value)}),(0,g.jsx)("div",{className:"textarea-container",children:(0,g.jsx)("div",{className:"input-info-container",children:(0,g.jsx)("textarea",{type:"text",className:"input-info",ref:S,value:s,onChange:e=>a(e.target.value),onKeyDown:e=>{if(l){const t=S.current,n=t.selectionStart,i=t.selectionEnd,r=s.slice(n,i);e.ctrlKey&&"b"===e.key?(e.preventDefault(),a(`${s.slice(0,n)}**${r}**${s.slice(i)}`)):e.ctrlKey&&"i"===e.key?(e.preventDefault(),a(`${s.slice(0,n)}*${r}*${s.slice(i)}`)):e.ctrlKey&&"u"===e.key&&(e.preventDefault(),a(`${s.slice(0,n)}<u>${r}</u>${s.slice(i)}`))}},onFocus:()=>h(!0),onBlur:()=>h(!1)})})}),(0,g.jsxs)("div",{className:"point-info-buttons",children:[(0,g.jsx)("button",{className:"save-button",onClick:async()=>{let r=e.id,o=i,a=s;if(o&&a){console.log(o+" "+a),await w({id:r,name:o,description:a});const i={...e,id:r,name:o,description:a};t(d({...i})),console.log(i),t(c("close")),n("\u0422\u043e\u0447\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430","info")}},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"}),(0,g.jsx)("button",{className:"del-button",onClick:()=>f(!0),children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]})]})]})}const G=n.p+"static/media/search.7f7009cb3d95c5ee5aa01d3d02f7e5d0.svg";function K(){const e=(0,p.wA)(),[t,n]=(0,r.useState)(""),[i,o]=(0,r.useState)(!1),s=()=>{e(l(t)),e(c("search"))};return(0,g.jsxs)("div",{className:"searchbar",children:[(0,g.jsx)("input",{placeholder:"\u041f\u043e\u0438\u0441\u043a",value:t,onFocus:()=>o(!0),onChange:e=>{n(e.target.value)},onKeyDown:e=>{i&&"Enter"===e.key&&s()}}),(0,g.jsx)("img",{src:R,className:"divider",alt:"divider"}),(0,g.jsx)("button",{className:"searchButton",onPointerDown:s,children:(0,g.jsx)("img",{src:G,alt:"search"})})]})}function Y(e){let{title:t,category:n,currMenu:i,closeButton:r}=e;return(0,g.jsxs)("div",{className:"info-bar-container",children:[r,(0,g.jsx)(K,{}),"close"!==i&&(0,g.jsxs)("div",{className:"info-container",children:[(0,g.jsx)("div",{className:"organ-title",children:t}),(0,g.jsx)("div",{className:"organ-category",children:n})]})]})}function U(e){let{currMenu:t,closeHandler:n}=e;return(0,g.jsx)("button",{className:"close"===t?"close-button":"close-button close-button-open",onClick:n})}function Z(){const e=(0,p.d4)((e=>e.atlas.targetPoint));return(0,g.jsxs)("div",{className:"point-info-container",children:[(0,g.jsxs)("h1",{children:[e.name,(0,g.jsx)("br",{})]}),(0,g.jsx)("div",{className:"markdown",children:(0,g.jsx)(W,{children:e.description})})]})}var q=n(3900);const J={isCaseSensitive:!1,threshold:.3,keys:["name","description"]};function Q(e){let{point:t}=e;const n=(0,p.wA)();return(0,g.jsxs)("div",{className:"search-item",onPointerDown:()=>{n(d({...t})),n(c("info"))},children:[(0,g.jsx)("h2",{className:"item-title",children:t.name}),(0,g.jsx)("p",{className:"item-description",children:(0,g.jsx)(W,{children:t.description})})]})}function X(e){let{points:t}=e;const[n,i]=(0,r.useState)([]),o=(0,p.d4)((e=>e.atlas.searchString));return(0,r.useEffect)((()=>{i(t)}),[]),(0,r.useEffect)((()=>{if(""===o)return i(t),void console.log(t);i(((e,t)=>{const n=new q.A(e,J);console.log([{id:1},{id:2},{id:3}]),console.log(e),console.log(t);const i=n.search(t);return console.log(i),i.map((e=>e.item))})(t,o))}),[o]),(0,g.jsxs)("div",{className:"point-search-container",children:[(0,g.jsx)("h2",{children:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043f\u043e\u0438\u0441\u043a\u0430"}),n&&0!==n.length&&n.map((e=>(0,g.jsx)(Q,{point:e},e.id))),0===n.length&&(0,g.jsx)("span",{children:"\u041f\u043e \u0432\u0430\u0448\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e :("})]})}function ee(e){let{slideData:t}=e;const n=(0,p.d4)((e=>e.atlas.currMenu)),i=(0,p.wA)(),[o,s]=(0,r.useState)("info");(0,r.useEffect)((()=>{"menu"===n&&s("menu"),"info"===n&&s("info")}),[n]);return(0,g.jsxs)("div",{className:"point-menu",children:[(0,g.jsx)(Y,{title:t.organ.name,category:"TODO",points:t.points,currMenu:n,closeButton:(0,g.jsx)(U,{currMenu:n,closeHandler:()=>{if(console.log(o),"close"===n)switch(o){case"menu":default:i(c("menu"));break;case"info":i(c("info"))}else"menu"===n&&s("menu"),"info"===n&&s("info"),i(c("close"))}})}),"close"!==n&&(0,g.jsxs)("div",{className:"menu-container",children:["info"===n&&(0,g.jsx)(Z,{}),"menu"===n&&(0,g.jsx)(B,{}),"search"===n&&(0,g.jsx)(X,{points:t.points})]})]})}const te=()=>{const{id:e}=(0,i.g)(),t=(0,r.useRef)(null),[n,o]=(0,r.useState)(null),[s,a]=(0,r.useState)(!0),[c,l]=(0,r.useState)(!1),d=(0,i.Zp)();(0,r.useEffect)((()=>{(async()=>{try{const t=await async function(e){try{const t=await(0,y.A)(`/v1/points/get-by-organid/${e}`);if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error fetching points by organ ID:",t.message)}}(e),n=await(0,b.$)(e);if(!t||!n)return void console.error("Error fetching points or organ data");const i=`${N.Q}/${e}/${e}.dzi`;o({points:t,dziPath:i,organ:n})}catch(t){console.error("Error fetching slide data:",t)}finally{a(!1)}})()}),[e]);return(0,g.jsx)(p.Kq,{store:u,children:(0,g.jsxs)("div",{className:"slide-page-container",children:[n&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{className:"go-back-button",onClick:()=>{d(`/admin/categories/${n.organ.categoryid}`)},children:(0,g.jsx)("img",{src:k.A,alt:"arrow"})}),(0,g.jsx)(S,{ref:t,slideData:n,onViewerReady:()=>{l(!0)},className:"atlas-viewer"}),(0,g.jsx)(C,{togglePointsVisibility:e=>{t.current&&t.current.togglePoints(e)}}),(0,g.jsx)(O,{}),(0,g.jsxs)("div",{className:"overlay-menu-grid",children:[(0,g.jsx)("div",{className:"toolbar-layout",children:(0,g.jsx)(L,{})}),(0,g.jsx)("div",{className:"point-menu-layout",children:(0,g.jsx)(ee,{slideData:n})})]})]}),(s||!c)&&(0,g.jsx)(T,{})]})})}},6936:()=>{}}]);
//# sourceMappingURL=393.3d6f105f.chunk.js.map