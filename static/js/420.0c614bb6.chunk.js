"use strict";(self.webpackChunkhuman_atlas=self.webpackChunkhuman_atlas||[]).push([[420],{1605:(e,t,n)=>{n.d(t,{A:()=>i});n(5043);const i=n.p+"static/media/arrow.baa7a90e2c8d3c8b486f638718764678.svg"},7509:(e,t,n)=>{n.d(t,{A:()=>o});n(5043);var i=n(4545),s=n(579);function o(e){let{isOpen:t,onClose:n,onConfirm:o,title:r,message:a,actionName:c,actionColor:l}=e;return t?(0,s.jsxs)(i.A,{title:r,onClose:n,children:[(0,s.jsx)("p",{children:a}),(0,s.jsxs)("div",{className:"modal-actions",children:[(0,s.jsx)("button",{className:"modal-button cancel-button",onClick:n,children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),(0,s.jsx)("button",{className:`modal-button confirm-button ${l}`,onClick:o,children:c})]})]}):null}},4545:(e,t,n)=>{n.d(t,{A:()=>s});n(5043),n(6936);var i=n(579);function s(e){let{title:t,children:n,onClose:s,className:o}=e;return(0,i.jsx)("div",{className:"modal-overlay",onPointerDown:e=>{e.target.classList.contains("modal-overlay")&&s()},children:(0,i.jsxs)("div",{className:`modal-container ${o||""}`,children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h2",{children:t}),(0,i.jsx)("button",{className:"close-button",onClick:s,children:"\u2715"})]}),(0,i.jsx)("div",{className:"modal-content",children:n})]})})}},3541:(e,t,n)=>{n.d(t,{$:()=>s,F:()=>o});var i=n(6654);async function s(e){try{const t=await(0,i.A)(`/v1/organs/get/${e}`);if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error fetching organ by organ ID:",t.message)}}async function o(e){try{const t=await(0,i.A)(`/v1/organs/get-by-categoryid/${e}`);if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error fetching organ by organs ID:",t.message)}}},6420:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ee});var i=n(3216),s=n(5043),o=n(4391),r=n(9820),a=n.n(r);!function(e){if(!e.version||e.version.major<2)throw new Error("This version of OpenSeadragonScalebar requires OpenSeadragon version 2.0.0+");function t(e,t,n,s,r){r=void 0===r?" ":r;var a=i(e,t),c=o(a/e*t,3);return{size:a*t,text:c+r+n+(s&&c>1?"s":"")}}function n(e,t,n){var s=i(e,t),r=s*t,a=function(e,t){if(e<1e-6)return 1e9*e+" n"+t;if(e<.001)return 1e6*e+" \u03bc"+t;if(e<1)return 1e3*e+" m"+t;if(e>=1e3)return e/1e3+" k"+t;return e+" "+t}(o(s/e*t,3),n);return{size:r,text:a}}function i(e,t){var n=s(e),i=s(t),o=s(n/i);return o>=5&&(o/=5),o>=4&&(o/=4),o>=2&&(o/=2),o}function s(e){return e*Math.pow(10,Math.ceil(-r(e)))}function o(e,t){var n=t- -Math.ceil(-r(e)),i=e*Math.pow(10,n);return n<0?Math.round(i)*Math.pow(10,-n):Math.round(i)/Math.pow(10,n)}function r(e){return Math.log(e)/Math.log(10)}function a(e){return"undefined"!==typeof e}e.Viewer.prototype.scalebar=function(t){this.scalebarInstance?this.scalebarInstance.refresh(t):((t=t||{}).viewer=this,this.scalebarInstance=new e.Scalebar(t))},e.ScalebarType={NONE:0,MICROSCOPY:1,MAP:2},e.ScalebarLocation={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},e.Scalebar=function(t){if(!(t=t||{}).viewer)throw new Error("A viewer must be specified.");this.viewer=t.viewer,this.divElt=document.createElement("div"),this.viewer.container.appendChild(this.divElt),this.divElt.style.position="relative",this.divElt.style.margin="0",this.divElt.style.pointerEvents="none",this.setMinWidth(t.minWidth||"150px"),this.setDrawScalebarFunction(t.type||e.ScalebarType.MICROSCOPY),this.color=t.color||"black",this.fontColor=t.fontColor||"black",this.backgroundColor=t.backgroundColor||"none",this.fontSize=t.fontSize||"",this.fontFamily=t.fontFamily||"",this.barThickness=t.barThickness||2,this.pixelsPerMeter=t.pixelsPerMeter||null,this.referenceItemIdx=t.referenceItemIdx||0,this.location=t.location||e.ScalebarLocation.BOTTOM_LEFT,this.xOffset=t.xOffset||5,this.yOffset=t.yOffset||5,this.stayInsideImage=!a(t.stayInsideImage)||t.stayInsideImage,this.sizeAndTextRenderer=t.sizeAndTextRenderer||e.ScalebarSizeAndTextRenderer.METRIC_LENGTH;var n=this;this.viewer.addHandler("open",(function(){n.refresh()})),this.viewer.addHandler("animation",(function(){n.refresh()})),this.viewer.addHandler("resize",(function(){n.refresh()}))},e.Scalebar.prototype={updateOptions:function(e){e&&(a(e.type)&&this.setDrawScalebarFunction(e.type),a(e.minWidth)&&this.setMinWidth(e.minWidth),a(e.color)&&(this.color=e.color),a(e.fontColor)&&(this.fontColor=e.fontColor),a(e.backgroundColor)&&(this.backgroundColor=e.backgroundColor),a(e.fontSize)&&(this.fontSize=e.fontSize),a(e.fontFamily)&&(this.fontFamily=e.fontFamily),a(e.barThickness)&&(this.barThickness=e.barThickness),a(e.pixelsPerMeter)&&(this.pixelsPerMeter=e.pixelsPerMeter),a(e.referenceItemIdx)&&(this.referenceItemIdx=e.referenceItemIdx),a(e.location)&&(this.location=e.location),a(e.xOffset)&&(this.xOffset=e.xOffset),a(e.yOffset)&&(this.yOffset=e.yOffset),a(e.stayInsideImage)&&(this.stayInsideImage=e.stayInsideImage),a(e.sizeAndTextRenderer)&&(this.sizeAndTextRenderer=e.sizeAndTextRenderer))},setDrawScalebarFunction:function(t){t?t===e.ScalebarType.MAP?this.drawScalebar=this.drawMapScalebar:this.drawScalebar=this.drawMicroscopyScalebar:this.drawScalebar=null},setMinWidth:function(e){this.divElt.style.width=e,this.divElt.style.display="",this.minWidth=this.divElt.offsetWidth},refresh:function(e){if(this.updateOptions(e),this.viewer.isOpen()&&this.drawScalebar&&this.pixelsPerMeter&&this.location){this.divElt.style.display="";var t=this.viewer.viewport,n=function(e,t){var n=e._scaleSpring.current.value*e.viewport._containerInnerSize.x/e.source.dimensions.x;return n*t}(this.viewer.world.getItemAt(this.referenceItemIdx),t.getZoom(!0)),i=n*this.pixelsPerMeter,s=this.sizeAndTextRenderer(i,this.minWidth);this.drawScalebar(s.size,s.text);var o=this.getScalebarLocation();this.divElt.style.left=o.x+"px",this.divElt.style.top=o.y+"px"}else this.divElt.style.display="none"},drawMicroscopyScalebar:function(e,t){this.divElt.style.fontSize=this.fontSize,this.divElt.style.fontFamily=this.fontFamily,this.divElt.style.textAlign="center",this.divElt.style.color=this.fontColor,this.divElt.style.border="none",this.divElt.style.borderBottom=this.barThickness+"px solid "+this.color,this.divElt.style.backgroundColor=this.backgroundColor,this.divElt.innerHTML=t,this.divElt.style.width=e+"px"},drawMapScalebar:function(e,t){this.divElt.style.fontSize=this.fontSize,this.divElt.style.fontFamily=this.fontFamily,this.divElt.style.textAlign="center",this.divElt.style.color=this.fontColor,this.divElt.style.border=this.barThickness+"px solid "+this.color,this.divElt.style.borderTop="none",this.divElt.style.backgroundColor=this.backgroundColor,this.divElt.innerHTML=t,this.divElt.style.width=e+"px"},getScalebarLocation:function(){if(this.location===e.ScalebarLocation.TOP_LEFT){var t=0,n=0;if(this.stayInsideImage){var i=this.viewer.viewport.pixelFromPoint(new e.Point(0,0),!0);this.viewer.wrapHorizontal||(t=Math.max(i.x,0)),this.viewer.wrapVertical||(n=Math.max(i.y,0))}return new e.Point(t+this.xOffset,n+this.yOffset)}if(this.location===e.ScalebarLocation.TOP_RIGHT){var s=this.divElt.offsetWidth;t=(r=this.viewer.container).offsetWidth-s,n=0;if(this.stayInsideImage){i=this.viewer.viewport.pixelFromPoint(new e.Point(1,0),!0);this.viewer.wrapHorizontal||(t=Math.min(t,i.x-s)),this.viewer.wrapVertical||(n=Math.max(n,i.y))}return new e.Point(t-this.xOffset,n+this.yOffset)}if(this.location===e.ScalebarLocation.BOTTOM_RIGHT){s=this.divElt.offsetWidth;var o=this.divElt.offsetHeight;t=(r=this.viewer.container).offsetWidth-s,n=r.offsetHeight-o;if(this.stayInsideImage){i=this.viewer.viewport.pixelFromPoint(new e.Point(1,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(t=Math.min(t,i.x-s)),this.viewer.wrapVertical||(n=Math.min(n,i.y-o))}return new e.Point(t-this.xOffset,n-this.yOffset)}if(this.location===e.ScalebarLocation.BOTTOM_LEFT){var r;o=this.divElt.offsetHeight,t=0,n=(r=this.viewer.container).offsetHeight-o;if(this.stayInsideImage){i=this.viewer.viewport.pixelFromPoint(new e.Point(0,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(t=Math.max(t,i.x)),this.viewer.wrapVertical||(n=Math.min(n,i.y-o))}return new e.Point(t+this.xOffset,n-this.yOffset)}},getAsCanvas:function(){var e=document.createElement("canvas");e.width=this.divElt.offsetWidth,e.height=this.divElt.offsetHeight;var t=e.getContext("2d");t.fillStyle=this.backgroundColor,t.fillRect(0,0,e.width,e.height),t.fillStyle=this.color,t.fillRect(0,e.height-this.barThickness,e.width,e.height),this.drawScalebar===this.drawMapScalebar&&(t.fillRect(0,0,this.barThickness,e.height),t.fillRect(e.width-this.barThickness,0,this.barThickness,e.height)),t.font=window.getComputedStyle(this.divElt).font,t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.fontColor;var n=e.width/2,i=e.height/2;return t.fillText(this.divElt.textContent,n,i),e},getImageWithScalebarAsCanvas:function(){var e=this.viewer.drawer.canvas,t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0);var i=this.getAsCanvas(),s=this.getScalebarLocation();return n.drawImage(i,s.x,s.y),t}},e.ScalebarSizeAndTextRenderer={METRIC_LENGTH:function(e,t){return n(e,t,"m")},IMPERIAL_LENGTH:function(e,n){var i=2*n,s=.0254*e;if(i<12*s)return i<s?t(s/1e3,n,"th"):t(s,n,"in");var o=12*s;return i<2e3*o?t(o,n,"ft"):t(5280*o,n,"mi")},ASTRONOMY:function(e,n){var i=2*n;if(i<60*e)return t(e,n,'"',!1,"");var s=60*e;return i<60*s?t(s,n,"'",!1,""):t(60*s,n,"&#176",!1,"")},STANDARD_TIME:function(e,i){var s=2*i;if(s<60*e)return n(e,i,"s");var o=60*e;if(s<60*o)return t(o,i,"minute",!0);var r=60*o;if(s<24*r)return t(r,i,"hour",!0);var a=24*r;return s<365.25*a?t(a,i,"day",!0):t(365.25*a,i,"year",!0)},METRIC_GENERIC:n}}(a());var c=n(3003),l=n(7741),d=n(579);function h(e){let{point:t,osdViewer:n}=e;const i=(0,c.d4)((e=>e.atlas.currMenu)),o=(0,c.d4)((e=>e.atlas.activeTool)),r=(0,c.d4)((e=>e.atlas.targetPoint)),a=(0,c.wA)();(0,s.useEffect)((()=>{console.log("INIT",t)}),[]);return(0,d.jsx)("div",{className:"point-container",onPointerDown:e=>{e.preventDefault(),"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===o&&(a((0,l.es)("menu")),a((0,l.OO)({...t})),a((0,l.$m)("\u041a\u0443\u0440\u0441\u043e\u0440"))),"\u041a\u0443\u0440\u0441\u043e\u0440"===o&&(a((0,l.es)("info")),a((0,l.OO)({...t}))),"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===o&&a((0,l.OO)({...t,status:"move"}))},children:(0,d.jsx)("div",{className:r.id!==t.id||"close"===i&&"move"!==r.status?"marker":"marker marker-select"})})}var u=n(6218),f=n(6654);async function m(e){try{const t=await(0,f.A)("/v1/points/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error editing point:",t.message)}}var v=n(3541),p=n(6065);const x=(0,s.forwardRef)(((e,t)=>{let{slideData:n,onViewerReady:i}=e;const r=(0,c.d4)((e=>e.atlas.activeTool)),x=(0,c.d4)((e=>e.atlas.targetPoint)),g=(0,c.wA)(),{showNotification:y}=(0,p.h)(),w=(0,s.useRef)(null),b=(0,s.useRef)(null),j=(0,s.useRef)([]),E=(0,s.useRef)([]),N=e=>{const t=document.createElement("div");j.current.push({point:e,container:t}),console.log(w),w.current.addOverlay({element:t,location:new(a().Point)(e.x,e.y),placement:a().Placement.CENTER});(0,o.createRoot)(t).render((0,d.jsx)(c.Kq,{store:u.A,children:(0,d.jsx)(h,{point:e,osdViewer:w})}))},S=()=>{j.current.forEach((e=>{let{point:t,container:n}=e;t.id===x.id&&w.current.removeOverlay(n)})),console.log("REMOVE OVERLAY",x),j.current=j.current.filter((e=>{let{point:t}=e;return t.id!==x.id}))},O=e=>{e?(j.current.forEach((e=>{let{container:t}=e;w.current.removeOverlay(t)})),j.current=[]):E.current.forEach((e=>N(e)))};(0,s.useImperativeHandle)(t,(()=>({togglePoints:O}))),(0,s.useEffect)((()=>(E.current=n.points,w.current=a()({id:b.current.id,prefixUrl:"https://openseadragon.github.io/openseadragon/images/",tileSources:n.dziPath,crossOriginPolicy:"Anonymous",zoomInButton:"zoom-in",zoomOutButton:"zoom-out"}),async function(){console.log("MPP");const e=await(0,v.$)(n.organ.id),t=Number(e.mpp_x);console.log(t);const i=1/(1e-6*t);w.current.scalebar({type:a().ScalebarType.MICROSCOPY,pixelsPerMeter:i,color:"#4670B4",fontColor:"#4670B4",backgroundColor:"rgba(255, 255, 255, 0.5)",barThickness:1,location:a().ScalebarLocation.TOP_LEFT,xOffset:200,yOffset:35,minWidth:"200px",maxWidth:"100px",stayInsideImage:!1})}(),console.log("OSD"),console.log(w),w.current.addHandler("canvas-click",(e=>{e.preventDefaultAction=!0})),w.current.addHandler("open",(()=>{E.current.forEach((e=>N(e))),i&&i()})),()=>{w.current&&(w.current.destroy(),w.current=null),j.current.forEach((e=>{let{container:t}=e;return t.remove()})),j.current=[],console.log("END")})),[]),(0,s.useEffect)((()=>{"del"===x.status&&(E.current=E.current.filter((e=>e.id!==x.id)),console.log("ZDES"),S());const{status:e,...t}=x;E.current=E.current.map((e=>e.id===x.id?{...e,...t}:e)),console.log("TARGET",x)}),[x]),(0,s.useEffect)((()=>{async function e(e){if(e.preventDefaultAction=!0,console.log("CANVAS-CLICK",r),"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===r){const t=w.current.viewport.pointFromPixel(e.position),i=await async function(e,t,n,i,s){try{const o=await(0,f.A)("/v1/points/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({x:e,y:t,organid:n,name:s,description:i})});if(o.error)throw new Error(o.error||"Failed to add point");return o}catch(o){console.error("Error adding point:",o.message)}}(t.x,t.y,n.organ.id,"","");y("\u0422\u043e\u0447\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430","info"),console.log("POINT ID",i.point_id);const s={description:"",id:i.point_id,name:"",organid:n.organ.id,x:t.x,y:t.y};N(s),E.current.push(s),g((0,l.OO)(s)),g((0,l.es)("menu")),g((0,l.$m)("\u041a\u0443\u0440\u0441\u043e\u0440"))}if("\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===r&&(console.log("PEREMESTIL",x),"move"===x.status)){console.log("MOVE");const t=w.current.viewport.pointFromPixel(e.position);T(x.id,t.x,t.y),g((0,l.OO)({...x,x:t.x,y:t.y})),console.log(x)}}if(w.current)return"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443"===r?g((0,l.es)("close")):"move"===x.status&&(console.log("REMOVE STATUS",x),T(x.id,x.x,x.y),g((0,l.OO)({...x,status:""}))),w.current.addHandler("canvas-click",e),()=>{console.log("remove HANDLERS"),w.current&&w.current.removeHandler("canvas-click",e)}}),[r,x]);const T=async(e,t,n)=>{const i=await m({id:e,x:t,y:n});console.log(i),console.log("position",t,n)};return(0,s.useEffect)((()=>{S(),E.current.forEach((e=>{e.id===x.id&&(console.log("SHOW OVERLAY",e),N(e))})),n.points=E.current}),[E.current]),(0,d.jsx)("div",{className:"map-container",children:(0,d.jsx)("div",{id:"openseadragon1",ref:b,className:"openseadragon-viewer"})})}));var g=n(6849);function y(){return(0,d.jsx)("div",{className:"loading-spinner",children:(0,d.jsx)(g.A,{color:"#3754ED",cssOverride:{},size:25})})}var w=n(3418);function b(e){let{togglePointsVisibility:t}=e;const[n,i]=(0,s.useState)(!1);return(0,d.jsxs)("label",{className:"toggle-points-checkbox float-menu-button",children:[(0,d.jsx)("input",{type:"checkbox",checked:n,onChange:()=>{i(!n),t(!n)}}),(0,d.jsx)("span",{className:"custom-checkbox"}),(0,d.jsx)("span",{className:"checkbox-label",children:"\u0421\u043a\u0440\u044b\u0442\u044c \u0442\u043e\u0447\u043a\u0438"})]})}var j=n(1605);function E(){return(0,d.jsxs)("div",{className:"zoombar float-menu-button",children:[(0,d.jsx)("button",{id:"zoom-in",className:"zoom-buttons",children:"+"}),(0,d.jsx)("button",{style:{fontWeight:900},id:"zoom-out",className:"zoom-buttons",children:"\u2013"})]})}const N=n.p+"static/media/cursor.f037f52ff781a646debab7b62eb69da4.svg";const S=n.p+"static/media/add-point.fd5aa138490e5e759d4ede72c9eec5be.svg";const O=n.p+"static/media/pencil.a01801efb66b39eaa7491cff551edf0c.svg";const T=n.p+"static/media/move-point.231559e29046f264e5a19c863f066124.svg";const k=n.p+"static/media/divider.9ef4e7d963e43794aaab02bcf7fa081d.svg";function C(e){let{icon:t,name:n,hotkey:i,isActive:o=!1,onClick:r}=e;const[a,c]=(0,s.useState)(!1),l=/Mac/i.test(navigator.platform)?"CMD":"CTRL";return(0,d.jsxs)("div",{className:"tool-button-container",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[(0,d.jsx)("button",{className:"tool-button "+(o?"active-tool":""),onPointerDown:r,title:`${n} (${l} + ${i.toUpperCase()})`,"aria-pressed":o,children:(0,d.jsx)("img",{src:t,alt:n})}),a&&(0,d.jsxs)("div",{className:"tooltip",children:[n," ",(0,d.jsxs)("span",{className:"hotkey-name",children:[l," + ",i.toUpperCase()]})]})]})}function I(){const e=(0,c.d4)((e=>e.atlas.activeTool)),t=(0,c.wA)(),n=[{icon:N,name:"\u041a\u0443\u0440\u0441\u043e\u0440",hotkey:"b"},{icon:S,name:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443",hotkey:"p"},{icon:O,name:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u0447\u043a\u0443",hotkey:"e"},{icon:T,name:"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443",hotkey:"m"}],i=e=>{console.log(e),t((0,l.$m)(e))},o=e=>{if(!(e.ctrlKey||e.metaKey))return;const t=n.find((t=>t.hotkey===e.key.toLowerCase()));t&&(e.preventDefault(),i(t.name))};return(0,s.useEffect)((()=>(window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)})),[]),(0,d.jsx)("div",{className:"toolbar-wrapper",children:(0,d.jsxs)("div",{className:"toolbar-container",children:[(0,d.jsx)("div",{className:"buttons-container",children:n.map((t=>(0,d.jsx)(C,{icon:t.icon,name:t.name,hotkey:t.hotkey,isActive:e===t.name,onClick:()=>i(t.name)},t.name)))}),(0,d.jsx)("img",{src:k,alt:"divider",className:"divider"}),(0,d.jsx)("button",{className:"saveAndExit",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438 \u0432\u044b\u0439\u0442\u0438"})]})})}const M=n.p+"static/media/search.948308faaf21c6dd72b98d3e1bcaa0af.svg";function A(){const e=(0,c.wA)(),[t,n]=(0,s.useState)(""),[i,o]=(0,s.useState)(!1),r=()=>{e((0,l.GF)(t)),e((0,l.es)("search"))};return(0,d.jsxs)("div",{className:"searchbar",children:[(0,d.jsx)("input",{placeholder:"\u041f\u043e\u0438\u0441\u043a",value:t,onFocus:()=>o(!0),onChange:e=>{n(e.target.value)},onKeyDown:e=>{i&&"Enter"===e.key&&r()}}),(0,d.jsx)("img",{src:k,className:"divider",alt:"divider"}),(0,d.jsx)("button",{className:"searchButton",onPointerDown:r,children:(0,d.jsx)("img",{src:M,alt:"search"})})]})}function P(e){let{title:t,category:n,currMenu:i,closeButton:s}=e;return(0,d.jsxs)("div",{className:"info-bar-container",children:[s,(0,d.jsx)(A,{}),"close"!==i&&(0,d.jsxs)("div",{className:"info-container",children:[(0,d.jsx)("div",{className:"organ-title",children:t}),(0,d.jsx)("div",{className:"organ-category",children:n})]})]})}n(7950);function R(e){let{currMenu:t,closeHandler:n}=e;return(0,d.jsx)("button",{className:"close"===t?"close-button":"close-button close-button-open",onClick:n})}var z=n(9813),L=n(9285),D=n(9618),F=n(7977);const H=e=>{const t=F.A.sanitize(e,{ALLOWED_TAGS:["u","a","b","i"]});return console.log(e),console.log(t),t};function $(e){let{children:t}=e;const[n,i]=(0,s.useState)("");return(0,s.useEffect)((()=>{i(H(t))}),[t]),(0,d.jsx)("div",{className:"markdown",children:(0,d.jsx)(z.o,{remarkPlugins:[L.A],rehypePlugins:[D.A],children:n})})}function _(){const e=(0,c.d4)((e=>e.atlas.targetPoint));return(0,d.jsxs)("div",{className:"point-info-container",children:[(0,d.jsxs)("h1",{children:[e.name,(0,d.jsx)("br",{})]}),(0,d.jsx)("div",{className:"markdown-wrapper",children:(0,d.jsx)($,{children:e.description})})]})}function W(){return(0,d.jsx)("div",{className:"hint-menu",children:(0,d.jsxs)("pre",{children:[(0,d.jsx)("span",{className:"span-comb",children:"CTRL + B \u2013"})," ",(0,d.jsx)("span",{style:{fontWeight:800},children:"\u0436\u0438\u0440\u043d\u044b\u0439"}),(0,d.jsx)("br",{}),(0,d.jsx)("span",{className:"span-comb",children:"CTRL + I \u2013"})," ",(0,d.jsx)("span",{style:{fontStyle:"italic"},children:"\u043a\u0443\u0440\u0441\u0438\u0432"}),(0,d.jsx)("br",{}),(0,d.jsx)("span",{className:"span-comb",children:"CTRL + U \u2013"})," ",(0,d.jsx)("span",{style:{textDecoration:"underline"},children:"\u043f\u043e\u0434\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439"}),(0,d.jsx)("br",{}),(0,d.jsx)("span",{style:{fontWeight:700},children:"[\u0442\u0435\u043a\u0441\u0442](\u0441\u0441\u044b\u043b\u043a\u0430)"})," ",(0,d.jsxs)("span",{className:"span-other",children:["\u2013 ",(0,d.jsx)("span",{style:{textDecoration:"underline"},children:"\u0433\u0438\u043f\u0435\u0440\u0441\u044b\u043b\u043a\u0430"})]}),(0,d.jsx)("br",{}),(0,d.jsx)("span",{style:{fontWeight:700},children:"![\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435_\u0444\u043e\u0442\u043e](\u0441\u0441\u044b\u043b\u043a\u0430)"})," ",(0,d.jsx)("span",{className:"span-other",children:"- \u0444\u043e\u0442\u043e"}),(0,d.jsx)("br",{})]})})}const V=n.p+"static/media/pencil-blue.2aef9075f25451bb3268f8390fb67124.svg";const B=n.p+"static/media/eye.9a6d72f1f0927cca6f8e91b5ce64d068.svg";const K=n.p+"static/media/eye-blue.7e8255b0e55f8b9b0d22058d9cafc2ad.svg";function G(e){let{children:t,alt:n,isActive:i,onClick:s}=e;return(0,d.jsx)("button",{onClick:s,className:i?"button-markdown":"button-markdown button-active",children:(0,d.jsx)("img",{src:t,alt:n})})}var U=n(7509);function Y(){const e=(0,c.d4)((e=>e.atlas.targetPoint)),t=(0,c.wA)(),{showNotification:n}=(0,p.h)(),[i,o]=(0,s.useState)(""),[r,a]=(0,s.useState)(""),[h,u]=(0,s.useState)(!1),[v,x]=(0,s.useState)(!1),[g,y]=(0,s.useState)(!0),[w,b]=(0,s.useState)("markdown"),j=(0,s.useRef)(null);(0,s.useEffect)((()=>{o(e.name),a(e.description)}),[e]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(U.A,{isOpen:v,onClose:()=>{x(!1)},onConfirm:async()=>{await async function(e){try{const t=await(0,f.A)("/v1/points/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error deleting point:",t.message)}}(e.id),t((0,l.OO)({id:e.id,status:"del"})),t((0,l.es)("close")),n("\u0422\u043e\u0447\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u0430","info")},title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435",message:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443?",actionName:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",actionColor:"red"}),h&&(0,d.jsx)(W,{}),(0,d.jsxs)("div",{className:"point-menu-container",children:[(0,d.jsx)("input",{type:"text",className:"input-title",value:i,onChange:e=>o(e.target.value)}),(0,d.jsxs)("div",{className:"textarea-container",children:[(0,d.jsxs)("div",{className:"view-info-buttons",children:[(0,d.jsx)(G,{alt:"markdown",isActive:"markdown"===w,onClick:()=>{b("markdown"),y(!0)},children:"markdown"===w?O:V}),(0,d.jsx)(G,{alt:"view",isActive:"view"===w,onClick:()=>{b("view"),y(!1)},children:"view"===w?B:K})]}),(0,d.jsx)("div",{className:"input-info-container",children:g?(0,d.jsx)("textarea",{type:"text",className:"input-info",ref:j,value:r,onChange:e=>a(e.target.value),onKeyDown:e=>{const t=j.current;if(!h||!t)return;const n=t.selectionStart,i=t.selectionEnd,s=r.slice(n,i),o=(e.ctrlKey||e.metaKey)&&"KeyB"===e.code,c=(e.ctrlKey||e.metaKey)&&"KeyI"===e.code,l=(e.ctrlKey||e.metaKey)&&"KeyU"===e.code;o?(e.preventDefault(),a(`${r.slice(0,n)}**${s}**${r.slice(i)}`)):c?(e.preventDefault(),a(`${r.slice(0,n)}*${s}*${r.slice(i)}`)):l&&(e.preventDefault(),a(`${r.slice(0,n)}<u>${s}</u>${r.slice(i)}`))},onFocus:()=>u(!0),onBlur:()=>u(!1)}):(0,d.jsx)("div",{className:"markdown-wrapper",children:(0,d.jsx)($,{children:r})})})]}),(0,d.jsxs)("div",{className:"point-info-buttons",children:[(0,d.jsx)("button",{className:"save-button",onClick:async()=>{let s=e.id,o=i,a=r;if(o){console.log(o+" "+a),m({id:s,name:o,description:a});const i={...e,id:s,name:o,description:a};t((0,l.OO)({...i})),console.log(i),t((0,l.es)("close")),n("\u0422\u043e\u0447\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430","info")}else n("\u0423 \u0442\u043e\u0447\u043a\u0438 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","error")},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"}),(0,d.jsx)("button",{className:"del-button",onClick:()=>x(!0),children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]})]})]})}var J=n(3900);const Z={isCaseSensitive:!1,threshold:.3,keys:["name","description"]};function q(e){let{point:t}=e;const n=(0,c.wA)();return(0,d.jsxs)("div",{className:"search-item",onPointerDown:()=>{n((0,l.OO)({...t})),n((0,l.es)("info"))},children:[(0,d.jsx)("h2",{className:"item-title",children:t.name}),(0,d.jsx)("p",{className:"item-description",children:(0,d.jsx)($,{children:t.description})})]})}function Q(e){let{points:t}=e;const[n,i]=(0,s.useState)([]),o=(0,c.d4)((e=>e.atlas.searchString));return(0,s.useEffect)((()=>{i(t)}),[]),(0,s.useEffect)((()=>{if(""===o)return i(t),void console.log(t);i(((e,t)=>{const n=new J.A(e,Z);console.log([{id:1},{id:2},{id:3}]),console.log(e),console.log(t);const i=n.search(t);return console.log(i),i.map((e=>e.item))})(t,o))}),[o]),(0,d.jsxs)("div",{className:"point-search-container",children:[(0,d.jsx)("h2",{children:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043f\u043e\u0438\u0441\u043a\u0430"}),n&&0!==n.length&&n.map((e=>(0,d.jsx)(q,{point:e},e.id))),0===n.length&&(0,d.jsx)("span",{children:"\u041f\u043e \u0432\u0430\u0448\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e :("})]})}function X(e){let{slideData:t}=e;const n=(0,c.d4)((e=>e.atlas.currMenu)),i=(0,c.wA)(),[o,r]=(0,s.useState)("info");(0,s.useEffect)((()=>{"menu"===n&&r("menu"),"info"===n&&r("info")}),[n]);return(0,d.jsxs)("div",{className:"close"!==n?"point-menu":"point-menu point-menu-close",children:[(0,d.jsx)("div",{className:"close-button-container",children:(0,d.jsx)(R,{currMenu:n,closeHandler:()=>{if(console.log(o),"close"===n)switch(o){case"menu":default:i((0,l.es)("menu"));break;case"info":i((0,l.es)("info"))}else"menu"===n&&r("menu"),"info"===n&&r("info"),i((0,l.es)("close"))}})}),(0,d.jsxs)("div",{className:"menu-content",children:[(0,d.jsx)(P,{title:t.organ.name,category:"TODO",points:t.points,currMenu:n}),"close"!==n&&(0,d.jsxs)("div",{className:"menu-container",children:["info"===n&&(0,d.jsx)(_,{}),"menu"===n&&(0,d.jsx)(Y,{}),"search"===n&&(0,d.jsx)(Q,{points:t.points})]})]})]})}const ee=()=>{const e=(0,c.wA)(),{id:t}=(0,i.g)(),n=(0,s.useRef)(null),[o,r]=(0,s.useState)(null),[a,h]=(0,s.useState)(!0),[u,m]=(0,s.useState)(!1),p=(0,i.Zp)();(0,s.useEffect)((()=>{(async()=>{try{const e=await async function(e){try{const t=await(0,f.A)(`/v1/points/get-by-organid/${e}`);if(t.error)throw new Error(t.error||"Failed to add point");return t}catch(t){console.error("Error fetching points by organ ID:",t.message)}}(t),n=await(0,v.$)(t);if(!e||!n)return void console.error("Error fetching points or organ data");const i=`${w.Q}/${t}/${t}.dzi`;r({points:e,dziPath:i,organ:n})}catch(e){console.error("Error fetching slide data:",e)}finally{h(!1)}})()}),[t]);return(0,d.jsxs)("div",{className:"slide-page-container",children:[o&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{className:"go-back-button",onClick:()=>{e((0,l.es)("close")),p(`/human-atlas/admin/categories/${o.organ.categoryid}`)},children:(0,d.jsx)("img",{src:j.A,alt:"arrow"})}),(0,d.jsx)(x,{ref:n,slideData:o,onViewerReady:()=>{m(!0)},className:"atlas-viewer"}),(0,d.jsx)(b,{togglePointsVisibility:e=>{n.current&&n.current.togglePoints(e)}}),(0,d.jsx)(E,{}),(0,d.jsxs)("div",{className:"overlay-menu-grid",children:[(0,d.jsx)("div",{className:"toolbar-layout",children:(0,d.jsx)(I,{})}),(0,d.jsx)("div",{className:"point-menu-layout",children:(0,d.jsx)(X,{slideData:o})})]})]}),(a||!u)&&(0,d.jsx)(y,{})]})}},6936:()=>{}}]);
//# sourceMappingURL=420.0c614bb6.chunk.js.map